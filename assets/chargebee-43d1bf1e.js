import{$ as e,a0 as t,ac as n,b as o,s as a,P as s}from"./index-4d37af9a.js";function r(n,o,a){const s={type:n,properties:a=a||{}};(o=o||null)&&(s.guild_id=o),e("POST",t.Mee6.TRACK).send(s).then((()=>null))}function c(e,t=null,n){n=n||{},window.ga&&window.ga("send","event",{eventCategory:t?"guild":"user",eventAction:e,eventLabel:n?.label}),r(e,t,n)}const i=(e,t,o,a)=>(t=t||{},n(`chargebee_checkout_${e}`,{...t,plan_category:a},o)),l=()=>{const{guild:e}=o(),t=async e=>{const t=document.getElementById("chargebee-script"),n=()=>{const e=Chargebee.getInstance(),t=e.openCheckout;return t.patched||(e.openCheckout=(e,n,o)=>{const{step:a,close:s,loaded:r,...c}=e;return t({step:e=>{if(a&&a(e),"thankyou_screen"===e){const e=(window&&window?.dataLayer?window?.dataLayer:[]).find((e=>"chargebee_ecommerce"===e.event));e&&i("purchase",e.purchase,n,o)}i(e,{},n,o)},close:()=>{s&&s(),i("close",{},n,o)},loaded:()=>{r&&r(),i("loaded",{},n,o)},...c})},e.openCheckout.patched=!0),e};if(null===t){const t=document.createElement("script");return t.id="chargebee-script",t.src="https://js.chargebee.com/v2/chargebee.js",t.async=!0,t.onload=()=>{Chargebee.init({site:a.CHARGEBEE_SITE,enableGTMTracking:!0,enableRefersionTracking:!0});const t=n();e(t)},void document.body.appendChild(t)}const o=n();e(o)};return{loadPortal:t,openUserPortal:()=>t((e=>(e=>{if(null===e)return;e.setPortalSession((()=>s.getUserBillingSession("@me").then((e=>e.ok?e.data:Promise.reject())))),e.createChargebeePortal().open({})})(e))),openGuildPortal:(n,o,a)=>t((t=>(async(t,n,o,a)=>{null!==t&&null!==e&&(t.setPortalSession((()=>a?a().then((e=>{if(e.ok)return e.data})):s.getGuildSession(e.id).then((e=>{if(e.ok)return e.data})))),t.createChargebeePortal().openSection({sectionType:window.Chargebee.getPortalSections().SUBSCRIPTION_DETAILS,params:{subscriptionId:n?.id}},{close:()=>o&&o()}))})(t,n,o,a)))}};export{c as m,r as t,l as u};